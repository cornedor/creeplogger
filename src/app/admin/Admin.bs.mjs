// Generated by ReScript, PLEASE EDIT WITH CARE

import * as Games from "../../helpers/Games.bs.mjs";
import * as Stats from "../../helpers/Stats.bs.mjs";
import * as React from "react";
import * as Button from "../../components/Button.bs.mjs";
import * as Js_dict from "@rescript/runtime/lib/es6/Js_dict.js";
import * as Players from "../../helpers/Players.bs.mjs";
import * as Database from "../../helpers/Database.bs.mjs";
import * as LoginForm from "./LoginForm.bs.mjs";
import Link from "next/link";
import * as DartsGames from "../../helpers/DartsGames.bs.mjs";
import * as Core__Option from "@rescript/core/src/Core__Option.bs.mjs";
import * as Auth from "firebase/auth";
import * as Primitive_option from "@rescript/runtime/lib/es6/Primitive_option.js";
import * as JsxRuntime from "react/jsx-runtime";

function Admin(props) {
  let user = Database.useUser();
  let match = React.useState(() => "");
  let setUpdate = match[1];
  let players = Players.useAllPlayers(undefined, undefined);
  let games = Games.useLastGames();
  let dartsGames = DartsGames.useLastGames();
  let content;
  if (user == null) {
    content = JsxRuntime.jsx(LoginForm.make, {});
  } else {
    let email = Core__Option.getOr(Primitive_option.fromNullable(user.email), "??@??");
    let name = Core__Option.getOr(Primitive_option.fromNullable(user.displayName), email);
    content = JsxRuntime.jsxs("div", {
      children: [
        "Welcome, " + name,
        JsxRuntime.jsx("h2", {
          children: "Actions",
          className: "py-2 text-xl font-semibold"
        }),
        JsxRuntime.jsx("div", {
          children: match[0],
          className: "text-green-300 py-2"
        }),
        JsxRuntime.jsxs("div", {
          children: [
            JsxRuntime.jsx(Button.make, {
              variant: "Grey",
              onClick: param => {
                setUpdate(param => "Recalculating...");
                Stats.recalculateStats().then(param => {
                  setUpdate(param => "Recalculating finished");
                  return Promise.resolve();
                });
              },
              children: "Recalculate scores & stats"
            }),
            JsxRuntime.jsx(Button.make, {
              variant: "Grey",
              onClick: param => {
                Auth.signOut(Database.auth);
              },
              children: "Logout"
            })
          ],
          className: "flex gap-4"
        }),
        JsxRuntime.jsxs("details", {
          children: [
            JsxRuntime.jsx("summary", {
              children: "Players",
              className: "p-2 bg-white/5 mt-2 hover:bg-white/10 select-none rounded"
            }),
            JsxRuntime.jsxs("table", {
              children: [
                JsxRuntime.jsx("thead", {
                  children: JsxRuntime.jsxs("tr", {
                    children: [
                      JsxRuntime.jsx("th", {
                        children: "Name"
                      }),
                      JsxRuntime.jsx("th", {
                        children: "Mattermost Handle"
                      }),
                      JsxRuntime.jsx("th", {
                        children: "Actions"
                      })
                    ]
                  })
                }),
                JsxRuntime.jsx("tbody", {
                  children: players.map(player => JsxRuntime.jsxs("tr", {
                    children: [
                      JsxRuntime.jsx("td", {
                        children: player.name,
                        className: "px-2 py-1"
                      }),
                      JsxRuntime.jsx("td", {
                        children: Core__Option.getOr(player.mattermostHandle, "Undefined"),
                        className: "px-2 py-1"
                      }),
                      JsxRuntime.jsxs("td", {
                        children: [
                          JsxRuntime.jsx("button", {
                            children: "Set MH",
                            className: "bg-slate-300 rounded py-1 px-3 text-black",
                            onClick: param => {
                              let handle = prompt("New handle");
                              let newrecord = {...player};
                              Players.writePlayer((newrecord.mattermostHandle = (handle == null) ? undefined : Primitive_option.some(handle), newrecord));
                            }
                          }),
                          JsxRuntime.jsx("button", {
                            children: "Remove",
                            className: "bg-slate-300 rounded py-1 px-3 text-black",
                            onClick: param => {
                              if (confirm("Are you sure you want to remove " + player.name + "?")) {
                                Players.removePlayer(player.key);
                                return;
                              }
                            }
                          })
                        ],
                        className: "px-2 py-1 flex gap-2"
                      })
                    ]
                  }, player.key))
                })
              ]
            })
          ]
        }),
        JsxRuntime.jsxs("details", {
          children: [
            JsxRuntime.jsx("summary", {
              children: "Last games",
              className: "p-2 bg-white/5 mt-2 hover:bg-white/10 select-none rounded"
            }),
            JsxRuntime.jsxs("table", {
              children: [
                JsxRuntime.jsx("thead", {
                  children: JsxRuntime.jsxs("tr", {
                    children: [
                      JsxRuntime.jsx("th", {
                        children: "Blue team"
                      }),
                      JsxRuntime.jsx("th", {
                        children: "Red team"
                      }),
                      JsxRuntime.jsx("th", {
                        children: "When"
                      }),
                      JsxRuntime.jsx("th", {
                        children: "Score"
                      }),
                      JsxRuntime.jsx("th", {
                        children: "Actions"
                      })
                    ]
                  })
                }),
                JsxRuntime.jsx("tbody", {
                  children: Js_dict.entries(games).toReversed().map(param => {
                    let game = param[1];
                    let key = param[0];
                    let bluePlayers = game.blueTeam.map(player => {
                      let player$1 = players.find(p => p.key === player);
                      if (player$1 !== undefined) {
                        return player$1.name;
                      } else {
                        return "...";
                      }
                    });
                    let redPlayers = game.redTeam.map(player => {
                      let player$1 = players.find(p => p.key === player);
                      if (player$1 !== undefined) {
                        return player$1.name;
                      } else {
                        return "...";
                      }
                    });
                    return JsxRuntime.jsxs("tr", {
                      children: [
                        JsxRuntime.jsx("td", {
                          children: bluePlayers.join(", "),
                          className: "px-2 py-1"
                        }),
                        JsxRuntime.jsx("td", {
                          children: redPlayers.join(", "),
                          className: "px-2 py-1"
                        }),
                        JsxRuntime.jsx("td", {
                          children: game.date.toISOString(),
                          className: "px-2 py-1"
                        }),
                        JsxRuntime.jsx("td", {
                          children: "Blue " + game.blueScore.toString() + ":" + game.redScore.toString() + " Red",
                          className: "px-2 py-1"
                        }),
                        JsxRuntime.jsx("td", {
                          children: JsxRuntime.jsx("button", {
                            children: "Remove",
                            className: "bg-slate-300 rounded py-1 px-3 text-black",
                            onClick: param => {
                              if (confirm("Are you sure you want to remove this (" + key + ") game?")) {
                                console.log("Ok");
                                Games.removeGame(key);
                                return;
                              }
                            }
                          }),
                          className: "px-2 py-1 flex gap-2"
                        })
                      ]
                    }, game.date.toString());
                  })
                })
              ]
            })
          ]
        }),
        JsxRuntime.jsxs("details", {
          children: [
            JsxRuntime.jsx("summary", {
              children: "Last darts games",
              className: "p-2 bg-white/5 mt-2 hover:bg-white/10 select-none rounded"
            }),
            JsxRuntime.jsxs("table", {
              children: [
                JsxRuntime.jsx("thead", {
                  children: JsxRuntime.jsxs("tr", {
                    children: [
                      JsxRuntime.jsx("th", {
                        children: "Winners"
                      }),
                      JsxRuntime.jsx("th", {
                        children: "Losers"
                      }),
                      JsxRuntime.jsx("th", {
                        children: "When"
                      }),
                      JsxRuntime.jsx("th", {
                        children: "Mode"
                      }),
                      JsxRuntime.jsx("th", {
                        children: "Actions"
                      })
                    ]
                  })
                }),
                JsxRuntime.jsx("tbody", {
                  children: Js_dict.entries(dartsGames).toReversed().map(param => {
                    let game = param[1];
                    let key = param[0];
                    let winners = game.winners.map(player => {
                      let player$1 = players.find(p => p.key === player);
                      if (player$1 !== undefined) {
                        return player$1.name;
                      } else {
                        return "...";
                      }
                    });
                    let losers = game.losers.map(player => {
                      let player$1 = players.find(p => p.key === player);
                      if (player$1 !== undefined) {
                        return player$1.name;
                      } else {
                        return "...";
                      }
                    });
                    return JsxRuntime.jsxs("tr", {
                      children: [
                        JsxRuntime.jsx("td", {
                          children: winners.join(", "),
                          className: "px-2 py-1"
                        }),
                        JsxRuntime.jsx("td", {
                          children: losers.join(", "),
                          className: "px-2 py-1"
                        }),
                        JsxRuntime.jsx("td", {
                          children: game.date.toISOString(),
                          className: "px-2 py-1"
                        }),
                        JsxRuntime.jsx("td", {
                          children: DartsGames.dartsModeToString(game.mode),
                          className: "px-2 py-1"
                        }),
                        JsxRuntime.jsx("td", {
                          children: JsxRuntime.jsx("button", {
                            children: "Remove",
                            className: "bg-slate-300 rounded py-1 px-3 text-black",
                            onClick: param => {
                              if (confirm("Are you sure you want to remove this (" + key + ") game?")) {
                                DartsGames.removeGame(key);
                                return;
                              }
                            }
                          }),
                          className: "px-2 py-1 flex gap-2"
                        })
                      ]
                    }, game.date.toString());
                  })
                })
              ]
            })
          ]
        })
      ]
    });
  }
  return JsxRuntime.jsxs("div", {
    children: [
      JsxRuntime.jsxs("h1", {
        children: [
          JsxRuntime.jsx(Link, {
            href: "/",
            children: "‚Üê Back - ",
            className: "font-thin"
          }),
          "Admin dashboard"
        ],
        className: "text-3xl pb-2 font-bold"
      }),
      content
    ],
    className: "bg-blobs bg-darkbg bg-no-repeat bg-left text-white flex flex-col min-h-screen w-full p-10"
  });
}

let make = Admin;

export {
  make,
}
/* Games Not a pure module */
