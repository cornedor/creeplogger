// Generated by ReScript, PLEASE EDIT WITH CARE

import * as Core__Array from "@rescript/core/src/Core__Array.bs.mjs";
import * as Primitive_int from "@rescript/runtime/lib/es6/Primitive_int.js";

function calculateScore(winners, losers, gameMode) {
  let getEloFn = extra => {
    if (gameMode === "Darts") {
      return extra.dartsElo;
    } else {
      return extra.elo;
    }
  };
  let totalEloA = Core__Array.reduce(winners, 0.0, (acc, creeper) => acc + getEloFn(creeper));
  let totalEloB = Core__Array.reduce(losers, 0.0, (acc, creeper) => acc + getEloFn(creeper));
  let countA = winners.length;
  let countB = losers.length;
  let max = Primitive_int.max(countA, countB);
  let mulA = countA === max ? max : 1.5;
  let mulB = countB === max ? max : 1.5;
  let avgA = totalEloA / mulA;
  let avgB = totalEloB / mulB;
  let losersScore = avgB;
  let winnersScore = avgA;
  let expectedScoreWinners = 1.0 / (1.0 + Math.pow(10.0, (losersScore - winnersScore) / 400.0));
  let expectedScoreLosers = 1.0 / (1.0 + Math.pow(10.0, (winnersScore - losersScore) / 400.0));
  let winners$1 = winners.map(creeper => {
    let change = 32.0 * (1.0 - expectedScoreWinners);
    let elo = (
      gameMode === "Darts" ? creeper.dartsElo : creeper.elo
    ) + change;
    if (gameMode === "Darts") {
      let newrecord = {...creeper};
      newrecord.dartsLastEloChange = change;
      newrecord.dartsElo = elo;
      return newrecord;
    }
    let newrecord$1 = {...creeper};
    newrecord$1.lastEloChange = change;
    newrecord$1.elo = elo;
    return newrecord$1;
  });
  let losers$1 = losers.map(creeper => {
    let change = 32.0 * (0.0 - expectedScoreLosers);
    let elo = (
      gameMode === "Darts" ? creeper.dartsElo : creeper.elo
    ) + change;
    if (gameMode === "Darts") {
      let newrecord = {...creeper};
      newrecord.dartsLastEloChange = change;
      newrecord.dartsElo = elo;
      return newrecord;
    }
    let newrecord$1 = {...creeper};
    newrecord$1.lastEloChange = change;
    newrecord$1.elo = elo;
    return newrecord$1;
  });
  return [
    winners$1,
    losers$1,
    32.0 * (1.0 - expectedScoreWinners)
  ];
}

function roundScore(score) {
  return Math.round(score) | 0;
}

export {
  calculateScore,
  roundScore,
}
/* No side effect */
